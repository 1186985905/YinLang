"use strict";(self["webpackChunkagentui"]=self["webpackChunkagentui"]||[]).push([[979],{9979:function(e,t,r){r.r(t),r.d(t,{default:function(){return c}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"user-management"},[t("h1",[e._v(" 用户管理 "),t("div",{staticClass:"header-buttons"},[t("el-button",{attrs:{type:"default",size:"small",icon:"el-icon-back"},on:{click:e.goToAdminPanel}},[e._v("返回管理面板")]),t("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-s-home"},on:{click:e.goToHome}},[e._v("返回主页")])],1)]),t("div",{staticClass:"search-form"},[t("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.searchForm}},[t("el-form-item",{attrs:{label:"用户名"}},[t("el-input",{attrs:{placeholder:"请输入用户名",clearable:""},model:{value:e.searchForm.username,callback:function(t){e.$set(e.searchForm,"username",t)},expression:"searchForm.username"}})],1),t("el-form-item",{attrs:{label:"部门"}},[t("el-select",{attrs:{placeholder:"请选择部门",clearable:""},model:{value:e.searchForm.departmentId,callback:function(t){e.$set(e.searchForm,"departmentId",t)},expression:"searchForm.departmentId"}},e._l(e.departmentMap,(function(e,r){return t("el-option",{key:r,attrs:{label:e,value:Number(r)}})})),1)],1),t("el-form-item",{attrs:{label:"权限"}},[t("el-select",{attrs:{placeholder:"请选择权限",clearable:""},model:{value:e.searchForm.role,callback:function(t){e.$set(e.searchForm,"role",t)},expression:"searchForm.role"}},[t("el-option",{attrs:{label:"超级管理员",value:"SUPER_ADMIN"}}),t("el-option",{attrs:{label:"普通用户",value:"NORMAL_USER"}})],1)],1),t("el-form-item",{attrs:{label:"创建时间"}},[t("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",clearable:""},model:{value:e.searchForm.timeRange,callback:function(t){e.$set(e.searchForm,"timeRange",t)},expression:"searchForm.timeRange"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("查询")]),t("el-button",{on:{click:e.resetSearch}},[e._v("重置")]),t("el-button",{attrs:{type:"primary"},on:{click:e.showCreateDialog}},[e._v("+ 创建新用户")])],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.userList}},[t("el-table-column",{attrs:{prop:"username",label:"用户名"}}),t("el-table-column",{attrs:{prop:"departmentId",label:"所属部门"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.getDepartmentName(t.row.departmentId))+" ")]}}])}),t("el-table-column",{attrs:{prop:"role",label:"权限"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-tag",{attrs:{type:"SUPER_ADMIN"===r.row.role?"danger":""}},[e._v(" "+e._s(e.getRoleName(r.row.role))+" ")])]}}])}),t("el-table-column",{attrs:{prop:"createdAt",label:"创建时间",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatDateTime(t.row.createdAt))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-button",{attrs:{size:"small",type:"primary",disabled:"SUPER_ADMIN"===r.row.role},on:{click:function(t){return e.handleEdit(r.row)}}},[e._v("编辑")]),t("el-button",{attrs:{size:"small",type:"danger",disabled:"SUPER_ADMIN"===r.row.role},on:{click:function(t){return e.handleDelete(r.row)}}},[e._v("删除")])]}}])})],1),t("div",{staticClass:"pagination"},[t("el-pagination",{attrs:{background:"",layout:"total, sizes, prev, pager, next, jumper",total:e.total,"page-size":e.searchForm.pageSize,"current-page":e.searchForm.page,"page-sizes":[10,20,50]},on:{"update:currentPage":function(t){return e.$set(e.searchForm,"page",t)},"update:current-page":function(t){return e.$set(e.searchForm,"page",t)},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),t("el-dialog",{attrs:{title:"create"===e.dialogType?"创建新用户":"编辑用户",visible:e.dialogVisible,width:"500px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{ref:"userFormRef",attrs:{model:e.userForm,rules:e.userFormRules,"label-width":"100px"}},["create"===e.dialogType?t("el-form-item",{attrs:{label:"用户名",prop:"username"}},[t("el-input",{model:{value:e.userForm.username,callback:function(t){e.$set(e.userForm,"username",t)},expression:"userForm.username"}})],1):e._e(),"create"===e.dialogType?t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{type:"password","show-password":""},model:{value:e.userForm.password,callback:function(t){e.$set(e.userForm,"password",t)},expression:"userForm.password"}})],1):e._e(),t("el-form-item",{attrs:{label:"所属部门",prop:"departmentId"}},[t("el-select",{attrs:{placeholder:"请选择部门"},model:{value:e.userForm.departmentId,callback:function(t){e.$set(e.userForm,"departmentId",t)},expression:"userForm.departmentId"}},e._l(e.departmentMap,(function(e,r){return t("el-option",{key:r,attrs:{label:e,value:Number(r)}})})),1)],1),t("el-form-item",{attrs:{label:"权限",prop:"role"}},[t("el-select",{attrs:{placeholder:"请选择权限"},model:{value:e.userForm.role,callback:function(t){e.$set(e.userForm,"role",t)},expression:"userForm.role"}},[t("el-option",{attrs:{label:"超级管理员",value:"SUPER_ADMIN"}}),t("el-option",{attrs:{label:"普通用户",value:"NORMAL_USER"}})],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("确定")])],1)],1)],1)},s=[],l=(r(8111),r(1701),r(2549)),o={name:"UserManagement",data(){return{loading:!1,userList:[],total:0,dialogVisible:!1,dialogType:"create",searchForm:{username:"",departmentId:null,role:null,timeRange:[],page:1,pageSize:10},userForm:{username:"",password:"",departmentId:null,role:"NORMAL_USER"},userFormRules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],departmentId:[{required:!0,message:"请选择部门",trigger:"change"}],role:[{required:!0,message:"请选择权限",trigger:"change"}]},departmentMap:{1:"研发部-前端组",2:"研发部-后端组",3:"产品部",4:"市场部",5:"管理部"}}},created(){this.fetchUserList()},methods:{async fetchUserList(){this.loading=!0;try{const e=await(0,l.aU)({...this.searchForm,page:this.searchForm.page,pageSize:this.searchForm.pageSize});e&&e.list?(this.userList=e.list.map((e=>({...e,createdAt:e.createdAt?new Date(e.createdAt).toLocaleString("zh-CN"):""}))),this.total=e.total):(this.userList=[],this.total=0,this.$message.warning("暂无数据"))}catch(e){console.error("获取用户列表失败:",e),this.$message.error("获取用户列表失败，请检查网络连接"),this.userList=[],this.total=0}finally{this.loading=!1}},handleSearch(){this.searchForm.page=1,this.fetchUserList()},resetSearch(){this.searchForm={username:"",departmentId:null,role:null,timeRange:[],page:1,pageSize:10},this.fetchUserList()},showCreateDialog(){this.dialogType="create",this.userForm={username:"",password:"",departmentId:null,role:"NORMAL_USER"},this.dialogVisible=!0,this.$nextTick((()=>{this.$refs.userFormRef?.resetFields()}))},handleEdit(e){this.dialogType="edit",this.userForm={id:e.id,departmentId:e.departmentId,role:e.role},this.dialogVisible=!0},async handleSubmit(){if(this.$refs.userFormRef)try{if(await this.$refs.userFormRef.validate(),"create"===this.dialogType)await(0,l.kg)(this.userForm),this.$message.success("创建成功");else{const{id:e,departmentId:t,role:r}=this.userForm;await(0,l.TK)(e,{departmentId:t,role:r}),this.$message.success("更新成功")}this.dialogVisible=!1,this.fetchUserList()}catch(e){console.error("操作失败:",e),this.$message.error(e.response?.data?.message||"操作失败")}},handleDelete(e){this.$confirm("确认删除该用户吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await(0,l.hG)(e.id),this.$message.success("删除成功"),this.fetchUserList()}catch(t){this.$message.error(t.message||"删除失败")}}))},handleSizeChange(e){this.searchForm.pageSize=e,this.fetchUserList()},handleCurrentChange(e){this.searchForm.page=e,this.fetchUserList()},getDepartmentName(e){return this.departmentMap[e]||"未知部门"},getRoleName(e){const t={SUPER_ADMIN:"超级管理员",NORMAL_USER:"普通用户"};return t[e]||e},formatDateTime(e){if(!e)return"";const t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})},goToAdminPanel(){this.$router.replace("/admin")},goToHome(){this.$router.replace("/")}}},i=o,n=r(1656),m=(0,n.A)(i,a,s,!1,null,null,null),c=m.exports}}]);
//# sourceMappingURL=979.f76fb3ff.js.map